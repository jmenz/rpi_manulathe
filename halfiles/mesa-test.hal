# Generated by stepconf 1.1 at Thu Apr  3 09:10:33 2025
# If you make changes to this file, they will be
# overwritten when you run stepconf again
loadrt [KINS]KINEMATICS
loadrt [EMCMOT]EMCMOT base_period_nsec=[EMCMOT]BASE_PERIOD servo_period_nsec=[EMCMOT]SERVO_PERIOD num_joints=[KINS]JOINTS

loadrt hal_gpio inputs=GPIO26 \
                            outputs=GPIO20,GPIO21 \
                            pullup=GPIO26 \
#                           invert=GPIO20,GPIO27 \
#                           reset=GPIO21,GPIO22

loadrt hostmot2
loadrt hm2_eth board_ip=192.168.1.121 config="sserial_port_0=003001"

setp hm2_7i92.0.watchdog.timeout_ns 2500000


addf hm2_7i92.0.read        servo-thread
addf hal_gpio.read          servo-thread
addf motion-command-handler servo-thread
addf motion-controller      servo-thread
addf hm2_7i92.0.write       servo-thread
addf hal_gpio.write         servo-thread


#net estop-out       => parport.0.pin-01-out
#net xstep           => parport.0.pin-02-out
#setp parport.0.pin-02-out-reset 1
#net xdir            => parport.0.pin-03-out
#net ystep           => parport.0.pin-04-out
#setp parport.0.pin-04-out-reset 1
#net ydir            => parport.0.pin-05-out
#net zstep           => parport.0.pin-06-out
#setp parport.0.pin-06-out-reset 1
#net zdir            => parport.0.pin-07-out
#net astep           => parport.0.pin-08-out
#setp parport.0.pin-08-out-reset 1
#net adir            => parport.0.pin-09-out
#net spindle-cw      => parport.0.pin-14-out
#net spindle-pwm     => parport.0.pin-16-out
#net xenable         => parport.0.pin-17-out


#net x-pos-cmd joint.0.motor-pos-cmd  => stm32_motion.0.pos-cmd
#net x-vel-cmd joint.0.vel-cmd => stm32_motion.0.vel-cmd
#net x-pos-fb  stm32_motion.0.pos-fb => joint.0.motor-pos-fb
#net x-enable => joint.0.amp-enable-out => stm32_motion.0.enable

#net x-pos-cmd joint.0.motor-pos-fb   #temp


#net z-pos-cmd joint.1.motor-pos-cmd  => stm32_motion.1.pos-cmd
#net z-vel-cmd joint.1.vel-cmd => stm32_motion.1.vel-cmd
#net z-pos-fb  stm32_motion.1.pos-fb => joint.1.motor-pos-fb
#net z-enable => joint.1.amp-enable-out => stm32_motion.1.enable

#net z-pos-cmd joint.1.motor-pos-fb   #temp



net estop-out <= iocontrol.0.user-enable-out
net estop-out => iocontrol.0.emc-enable-in
net estop-out => hal_gpio.GPIO21-out

loadusr -W hal_manualtoolchange
net tool-change iocontrol.0.tool-change => hal_manualtoolchange.change
net tool-changed iocontrol.0.tool-changed <= hal_manualtoolchange.changed
net tool-number iocontrol.0.tool-prep-number => hal_manualtoolchange.number
net tool-prepare-loopback iocontrol.0.tool-prepare => iocontrol.0.tool-prepared
